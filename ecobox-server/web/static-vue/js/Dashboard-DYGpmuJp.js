import{_ as z,h as G,f as d,c as l,a as n,b as _,t as v,n as I,F as E,i as P,e as C,g as q,j as V,o as i,k as L,l as N,m as A,u as H,p as J,q as K}from"./index-DpBmx_ty.js";import{V as Q,S as X,T as Y,u as Z}from"./ThemeToggle-CQnVklZy.js";const $={name:"ServerCard",components:{ServiceButton:X,VMDetails:Q},props:{server:{type:Object,required:!0}},emits:["wake","suspend","shutdown","stop"],setup(a){const s=q(),r=G(!1),t=d(()=>{switch(a.server.current_state){case"on":return"Online";case"off":return"Offline";case"suspended":return"Suspended";case"unknown":return"Unknown";case"init_failed":return"Init Failed";default:return a.server.current_state}}),p=d(()=>{const e="status-indicator";switch(a.server.current_state){case"on":return`${e} status-online`;case"off":return`${e} status-offline`;case"suspended":return`${e} status-suspended`;default:return`${e} status-unknown`}}),M=d(()=>{var o,m;const e=((o=a.server.system_info)==null?void 0:o.power_meter_watts)||((m=a.server.system_info)==null?void 0:m.power_estimate_watts);return e?Math.round(e):null}),w=d(()=>{var o;const e=(o=a.server.system_info)==null?void 0:o.memory_usage;return e?e.used_percent.toFixed(1):0}),h=d(()=>{var o;const e=(o=a.server.system_info)==null?void 0:o.network_usage;return e?((e.mbps_recv||0)+(e.mbps_sent||0)).toFixed(1):"0"}),b=d(()=>{if(a.server.current_state!=="on"||!a.server.last_state_change)return null;const e=new Date(a.server.last_state_change),m=new Date-e,k=Math.floor(m/1e3),g=Math.floor(k/60),f=Math.floor(g/60),x=Math.floor(f/24);return x>0?`${x}d ${f%24}h ${g%60}m`:f>0?`${f}h ${g%60}m`:`${g}m`}),y=e=>e==="up"?"service-online":"service-offline",u=e=>e==="running"?"vm-running":"vm-stopped",U=e=>{console.log(`Clicked service: ${e.name}:${e.port}`),B()},T=e=>null,D=e=>0,B=()=>{s.push(`/server/${a.server.id}`)},W=d(()=>{const e=a.server.current_state;return e==="off"||e==="suspended"||e==="unknown"||e==="init_failed"||e==="stopped"}),j=d(()=>{var m;const e=a.server.current_state,o=!!a.server.parent_server_id;return o&&console.log(`VM ${a.server.name}: state=${e}, parent_server_id=${a.server.parent_server_id}`),o?e==="on":(e==="on"||e==="init_failed")&&((m=a.server.system_info)==null?void 0:m.suspend_support)}),F=d(()=>{const e=!!a.server.parent_server_id,o=a.server.current_state,m=e&&o==="on";return e&&console.log(`VM ${a.server.name}: showShutdownButton=${m} (state=${o})`),m}),O=d(()=>{const e=!!a.server.parent_server_id,o=a.server.current_state,m=e&&o==="on";return e&&console.log(`VM ${a.server.name}: showStopButton=${m} (state=${o})`),m});return{actionLoading:r,statusText:t,statusClass:p,powerUsage:M,memoryUsage:w,networkUsage:h,uptimeDisplay:b,serviceStatusClass:y,vmStatusClass:u,handleServiceClick:U,getVMSystemInfo:T,getVMUptime:D,navigateToDetail:B,showWakeButton:W,showSuspendButton:j,showShutdownButton:F,showStopButton:O}}},ee={class:"card hover:shadow-lg transition-shadow cursor-pointer",style:{"background-color":"var(--bg-primary)",border:"1px solid var(--border-color)"}},se={class:"card-body"},te={class:"flex items-start justify-between mb-4"},ne={class:"font-semibold text-lg",style:{color:"var(--text-primary)"}},oe={class:"text-sm",style:{color:"var(--text-secondary)"}},re={class:"flex flex-col items-end gap-2"},ae={key:0,class:"text-sm",style:{color:"var(--text-secondary)"}},ie={key:0,class:"mb-4 space-y-2"},le={class:"flex justify-between text-sm"},ce={style:{color:"var(--text-primary)"}},de={class:"flex justify-between text-sm"},ue={style:{color:"var(--text-primary)"}},ve={class:"flex justify-between text-sm"},me={style:{color:"var(--text-primary)"}},_e={key:1,class:"mb-4"},fe={class:"text-sm mb-2",style:{color:"var(--text-secondary)"}},ye={class:"flex flex-wrap gap-2"},ge={key:0,class:"service-button",style:{"background-color":"var(--bg-secondary)",color:"var(--text-secondary)","border-color":"var(--border-color)"}},he={key:2,class:"mb-4"},be={class:"text-sm mb-2",style:{color:"var(--text-secondary)"}},we={class:"space-y-2"},ke={key:0,class:"vm-details-card compact",style:{"background-color":"var(--bg-secondary)",color:"var(--text-secondary)","border-color":"var(--border-color)","text-align":"center",padding:"0.5rem"}},xe={key:3,class:"mb-4"},Se={class:"flex justify-between text-sm"},Ce={style:{color:"var(--text-primary)","font-weight":"500"}},pe={class:"flex gap-2 mt-4"},Me=["disabled"],Ve={key:0,class:"loading w-3 h-3 mr-1"},De=["disabled"],Be={key:0,class:"loading w-3 h-3 mr-1"},Le=["disabled"],Ue={key:0,class:"loading w-3 h-3 mr-1"},Te=["disabled"],We={key:0,class:"loading w-3 h-3 mr-1"};function je(a,s,r,t,p,M){var b,y;const w=V("ServiceButton"),h=V("VMDetails");return i(),l("div",ee,[n("div",se,[n("div",te,[n("div",{onClick:s[0]||(s[0]=(...u)=>t.navigateToDetail&&t.navigateToDetail(...u)),class:"flex-1 cursor-pointer"},[n("h3",ne,v(r.server.name),1),n("p",oe,v(r.server.hostname),1)]),n("div",re,[n("span",{class:I(t.statusClass)},v(t.statusText),3),t.powerUsage?(i(),l("div",ae,v(t.powerUsage)+"W ",1)):_("",!0)])]),r.server.system_info?(i(),l("div",ie,[n("div",le,[s[6]||(s[6]=n("span",{style:{color:"var(--text-secondary)"}},"CPU:",-1)),n("span",ce,v(((b=r.server.system_info.cpu_usage)==null?void 0:b.toFixed(1))||0)+"%",1)]),n("div",de,[s[7]||(s[7]=n("span",{style:{color:"var(--text-secondary)"}},"Memory:",-1)),n("span",ue,v(t.memoryUsage)+"%",1)]),n("div",ve,[s[8]||(s[8]=n("span",{style:{color:"var(--text-secondary)"}},"Network:",-1)),n("span",me,v(t.networkUsage)+" Mbps",1)])])):_("",!0),r.server.services&&r.server.services.length>0?(i(),l("div",_e,[n("div",fe," Services ("+v(r.server.services.length)+"): ",1),n("div",ye,[(i(!0),l(E,null,P(r.server.services.slice(0,4),u=>(i(),L(w,{key:u.id,service:u,onClick:t.handleServiceClick},null,8,["service","onClick"]))),128)),r.server.services.length>4?(i(),l("span",ge," +"+v(r.server.services.length-4)+" more ",1)):_("",!0)])])):_("",!0),(y=r.server.system_info)!=null&&y.vms&&r.server.system_info.vms.length>0?(i(),l("div",he,[n("div",be," VMs ("+v(r.server.system_info.vms.length)+"): ",1),n("div",we,[(i(!0),l(E,null,P(r.server.system_info.vms.slice(0,3),u=>(i(),L(h,{key:u.vm_id,vm:u,size:"compact","vm-system-info":t.getVMSystemInfo(u),"uptime-seconds":t.getVMUptime(u)},null,8,["vm","vm-system-info","uptime-seconds"]))),128)),r.server.system_info.vms.length>3?(i(),l("div",ke," +"+v(r.server.system_info.vms.length-3)+" more VMs ",1)):_("",!0)])])):_("",!0),t.uptimeDisplay?(i(),l("div",xe,[n("div",Se,[s[9]||(s[9]=n("span",{style:{color:"var(--text-secondary)"}},"Uptime:",-1)),n("span",Ce,v(t.uptimeDisplay),1)])])):_("",!0),n("div",pe,[t.showWakeButton?(i(),l("button",{key:0,onClick:s[1]||(s[1]=u=>a.$emit("wake",r.server.id)),class:"btn btn-primary btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(i(),l("span",Ve)):_("",!0),s[10]||(s[10]=C(" Wake ",-1))],8,Me)):_("",!0),t.showSuspendButton?(i(),l("button",{key:1,onClick:s[2]||(s[2]=u=>a.$emit("suspend",r.server.id)),class:"btn btn-secondary btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(i(),l("span",Be)):_("",!0),s[11]||(s[11]=C(" Suspend ",-1))],8,De)):_("",!0),t.showShutdownButton?(i(),l("button",{key:2,onClick:s[3]||(s[3]=u=>a.$emit("shutdown",r.server.id)),class:"btn btn-warning btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(i(),l("span",Ue)):_("",!0),s[12]||(s[12]=C(" Shutdown ",-1))],8,Le)):_("",!0),t.showStopButton?(i(),l("button",{key:3,onClick:s[4]||(s[4]=u=>a.$emit("stop",r.server.id)),class:"btn btn-error btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(i(),l("span",We)):_("",!0),s[13]||(s[13]=C(" Stop ",-1))],8,Te)):_("",!0),n("button",{onClick:s[5]||(s[5]=(...u)=>t.navigateToDetail&&t.navigateToDetail(...u)),class:"btn btn-secondary btn-sm"}," Details ")])])])}const Fe=z($,[["render",je]]),Oe={name:"Dashboard",components:{ServerCard:Fe,ThemeToggle:Y},setup(){const a=q(),s=H(),r=Z(),t=d(()=>r.servers),p=d(()=>r.loading),M=d(()=>r.error),w=d(()=>r.websocketConnected),h=d(()=>s.isAdmin),b=d(()=>{const e=[...t.value],o=c=>c.includes("-vm-")||c.toLowerCase().includes("vm"),m=c=>c.includes("-vm-")?c.split("-vm-")[0]:c.replace(/[-_]?vm[-_]?\d+/i,""),k=e.filter(c=>!o(c.name)),g=e.filter(c=>o(c.name));k.sort((c,S)=>c.name.localeCompare(S.name));const f={};g.forEach(c=>{const S=m(c.name);f[S]||(f[S]=[]),f[S].push(c)}),Object.keys(f).forEach(c=>{f[c].sort((S,R)=>S.name.localeCompare(R.name))});const x=[];return k.forEach(c=>{x.push(c),f[c.name]&&(x.push(...f[c.name]),delete f[c.name])}),Object.values(f).forEach(c=>{x.push(...c)}),x}),y=d(()=>t.value.filter(e=>e.current_state==="on").length),u=d(()=>t.value.filter(e=>e.current_state==="off").length),U=d(()=>t.value.filter(e=>e.current_state==="suspended").length),T=d(()=>t.value.reduce((e,o)=>{var k,g;const m=((k=o.system_info)==null?void 0:k.power_meter_watts)||((g=o.system_info)==null?void 0:g.power_estimate_watts)||0;return e+m},0).toFixed(0)),D=async()=>{await r.fetchServers()},B=async()=>{await s.logout(),a.push("/login")},W=async e=>{const o=await r.wakeServer(e);o.success?console.log(o.message):console.error(o.message)},j=async e=>{const o=await r.suspendServer(e);o.success?console.log(o.message):console.error(o.message)},F=async e=>{const o=await r.shutdownServer(e);o.success?console.log(o.message):console.error(o.message)},O=async e=>{const o=await r.stopServer(e);o.success?console.log(o.message):console.error(o.message)};return J(async()=>{await D(),r.initializeWebSocket()}),K(()=>{r.disconnectWebSocket()}),{servers:t,sortedServers:b,loading:p,error:M,websocketConnected:w,isAdmin:h,onlineCount:y,offlineCount:u,suspendedCount:U,totalPowerUsage:T,fetchServers:D,handleLogout:B,handleWake:W,handleSuspend:j,handleShutdown:F,handleStop:O}}},Ee={class:"min-h-screen bg-gray-50",style:{"background-color":"var(--bg-secondary)"}},Pe={class:"main-header"},Ne={class:"container mx-auto px-6 py-4"},Ae={class:"flex items-center justify-between"},ze={class:"flex items-center gap-4"},Ie={class:"flex items-center gap-3"},qe={class:"container mx-auto px-6 py-6"},Re={key:0,class:"text-center py-8"},Ge={key:1,class:"text-center py-8"},He={class:"text-red-500"},Je={key:2},Ke={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},Qe={class:"card stats-card"},Xe={style:{color:"var(--primary-color)"}},Ye={class:"card stats-card"},Ze={style:{color:"#ef4444"}},$e={class:"card stats-card"},es={style:{color:"#f59e0b"}},ss={class:"card stats-card"},ts={style:{color:"var(--accent-color)"}},ns={key:0,class:"text-center py-8"},os={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"};function rs(a,s,r,t,p,M){const w=V("ThemeToggle"),h=V("router-link"),b=V("ServerCard");return i(),l("div",Ee,[n("header",Pe,[n("div",Ne,[n("div",Ae,[n("div",ze,[s[2]||(s[2]=n("h1",{class:"brand-title"},"EcoBox",-1)),s[3]||(s[3]=n("p",{class:"text-sm",style:{color:"var(--text-light)",margin:"0"}},"Sustainable Server Management",-1)),n("div",{class:I(["connection-indicator",t.websocketConnected?"connection-connected":"connection-disconnected"])},v(t.websocketConnected?"Connected":"Disconnected"),3)]),n("nav",Ie,[N(w),t.isAdmin?(i(),L(h,{key:0,to:"/users",class:"btn btn-secondary btn-sm"},{default:A(()=>s[4]||(s[4]=[C(" Users ",-1)])),_:1,__:[4]})):_("",!0),N(h,{to:"/profile",class:"btn btn-secondary btn-sm"},{default:A(()=>s[5]||(s[5]=[C(" Profile ",-1)])),_:1,__:[5]}),n("button",{onClick:s[0]||(s[0]=(...y)=>t.handleLogout&&t.handleLogout(...y)),class:"btn btn-danger btn-sm"}," Logout ")])])])]),n("main",qe,[t.loading?(i(),l("div",Re,s[6]||(s[6]=[n("div",{class:"loading w-8 h-8 mx-auto"},null,-1),n("p",{class:"mt-4",style:{color:"var(--text-secondary)"}},"Loading servers...",-1)]))):t.error?(i(),l("div",Ge,[n("p",He,v(t.error),1),n("button",{onClick:s[1]||(s[1]=(...y)=>t.fetchServers&&t.fetchServers(...y)),class:"btn btn-primary mt-4"}," Retry ")])):(i(),l("div",Je,[n("div",Ke,[n("div",Qe,[n("h3",Xe,v(t.onlineCount),1),s[7]||(s[7]=n("p",null,"Online",-1))]),n("div",Ye,[n("h3",Ze,v(t.offlineCount),1),s[8]||(s[8]=n("p",null,"Offline",-1))]),n("div",$e,[n("h3",es,v(t.suspendedCount),1),s[9]||(s[9]=n("p",null,"Suspended",-1))]),n("div",ss,[n("h3",ts,v(t.totalPowerUsage)+"W",1),s[10]||(s[10]=n("p",null,"Power Usage",-1))])]),t.servers.length===0?(i(),l("div",ns,s[11]||(s[11]=[n("p",{style:{color:"var(--text-secondary)"}},"No servers configured",-1)]))):(i(),l("div",os,[(i(!0),l(E,null,P(t.sortedServers,y=>(i(),L(b,{key:y.id,server:y,onWake:t.handleWake,onSuspend:t.handleSuspend,onShutdown:t.handleShutdown,onStop:t.handleStop},null,8,["server","onWake","onSuspend","onShutdown","onStop"]))),128))]))]))])])}const ls=z(Oe,[["render",rs]]);export{ls as default};
