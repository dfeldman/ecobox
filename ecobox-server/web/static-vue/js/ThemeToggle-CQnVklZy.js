import{J as x,K as _,_ as b,h as T,f as h,c as a,a as o,b as m,t as u,n as p,o as c,F as D,i as I,e as y,g as L,p as E}from"./index-DpBmx_ty.js";class z{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.isManualClose=!1,this.listeners={open:[],close:[],error:[],message:[]}}connect(){if(this.ws&&this.ws.readyState===WebSocket.OPEN)return;this.isManualClose=!1;const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;try{this.ws=new WebSocket(s),this.ws.onopen=n=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.listeners.open.forEach(i=>i(n))},this.ws.onclose=n=>{console.log("WebSocket disconnected",n.code,n.reason),this.listeners.close.forEach(i=>i(n)),!this.isManualClose&&this.reconnectAttempts<this.maxReconnectAttempts&&n.code!==1e3&&n.code!==1002&&this.scheduleReconnect()},this.ws.onerror=n=>{console.error("WebSocket error:",n),this.listeners.error.forEach(i=>i(n))},this.ws.onmessage=n=>{try{const i=JSON.parse(n.data);this.listeners.message.forEach(v=>v(i))}catch(i){console.error("Error parsing WebSocket message:",i)}}}catch(n){console.error("Error creating WebSocket:",n),this.scheduleReconnect()}}scheduleReconnect(){this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${this.reconnectDelay}ms`),setTimeout(()=>{this.isManualClose||this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(this.reconnectDelay*2,this.maxReconnectDelay)}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket is not open, cannot send message")}onOpen(e){this.listeners.open.push(e)}onClose(e){this.listeners.close.push(e)}onError(e){this.listeners.error.push(e)}onMessage(e){this.listeners.message.push(e)}removeListener(e,s){const n=this.listeners[e].indexOf(s);n>-1&&this.listeners[e].splice(n,1)}get isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const k=new z,Ue=x("servers",{state:()=>({servers:[],currentServer:null,loading:!1,error:null,websocketConnected:!1}),getters:{getServerById:t=>e=>t.servers.find(s=>s.id===e),onlineServers:t=>t.servers.filter(e=>e.current_state==="on"),offlineServers:t=>t.servers.filter(e=>e.current_state==="off"),suspendedServers:t=>t.servers.filter(e=>e.current_state==="suspended"),stoppedServers:t=>t.servers.filter(e=>e.current_state==="stopped"),transitioningServers:t=>t.servers.filter(e=>["waking","suspending","stopping"].includes(e.current_state)),serversByState:t=>t.servers.reduce((e,s)=>(e[s.current_state]||(e[s.current_state]=[]),e[s.current_state].push(s),e),{})},actions:{async fetchServers(){var t,e;this.loading=!0,this.error=null;try{const s=await _.get("/servers");this.servers=s.data.data}catch(s){this.error=((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch servers",console.error("Error fetching servers:",s)}finally{this.loading=!1}},async fetchServer(t){var e,s;this.loading=!0,this.error=null;try{const n=await _.get(`/servers/${t}`);this.currentServer=n.data.data;const i=this.servers.findIndex(v=>v.id===t);i!==-1&&(this.servers[i]=n.data.data)}catch(n){this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to fetch server",console.error("Error fetching server:",n)}finally{this.loading=!1}},async wakeServer(t){var e,s;try{return{success:!0,message:(await _.post(`/servers/${t}/wake`)).data.message}}catch(n){const i=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to wake server";return console.error("Error waking server:",n),{success:!1,message:i}}},async suspendServer(t){var e,s;try{return{success:!0,message:(await _.post(`/servers/${t}/suspend`)).data.message}}catch(n){const i=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to suspend server";return console.error("Error suspending server:",n),{success:!1,message:i}}},async shutdownServer(t){var e,s;try{return{success:!0,message:(await _.post(`/servers/${t}/shutdown`)).data.message}}catch(n){const i=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to shutdown server";return console.error("Error shutting down server:",n),{success:!1,message:i}}},async stopServer(t){var e,s;try{return{success:!0,message:(await _.post(`/servers/${t}/stop`)).data.message}}catch(n){const i=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to stop server";return console.error("Error stopping server:",n),{success:!1,message:i}}},initializeWebSocket(){k.connect(),k.onOpen(()=>{this.websocketConnected=!0}),k.onClose(()=>{this.websocketConnected=!1}),k.onMessage(t=>{this.handleWebSocketUpdate(t)})},handleWebSocketUpdate(t){if(t.server_id&&t.server){const e=this.servers.findIndex(s=>s.id===t.server_id);e!==-1&&(this.servers[e]={...this.servers[e],...t.server}),this.currentServer&&this.currentServer.id===t.server_id&&(this.currentServer={...this.currentServer,...t.server})}},disconnectWebSocket(){k.disconnect(),this.websocketConnected=!1},clearError(){this.error=null}}}),W={name:"ServiceButton",props:{service:{type:Object,required:!0},showTooltips:{type:Boolean,default:!0}},emits:["click"],setup(t,{emit:e}){const s=T(!1),n=h(()=>t.service.status==="up"?"service-online":"service-offline"),i=h(()=>{const g=t.service.type||"custom";return g.charAt(0).toUpperCase()+g.slice(1)}),v=h(()=>{const g=t.service.status==="up"?"Online":"Offline",S=i.value;return`${t.service.name}:${t.service.port} - ${g} (${S})`}),d=h(()=>{if(!t.service.last_check)return"Never";const g=new Date(t.service.last_check),r=new Date-g,l=Math.floor(r/1e3),f=Math.floor(l/60),w=Math.floor(f/60),M=Math.floor(w/24);return M>0?`${M}d ago`:w>0?`${w}h ago`:f>0?`${f}m ago`:`${l}s ago`});return{showTooltip:s,statusClass:n,serviceTypeDisplay:i,tooltipText:v,formatLastCheck:d,handleClick:()=>{e("click",t.service)}}}},B={class:"service-button-wrapper"},A=["title"],O={class:"service-name"},N={class:"service-port"},F={class:"tooltip-content"},U={class:"tooltip-header"},V={class:"tooltip-details"},R={class:"tooltip-row"},j={class:"tooltip-value"},P={class:"tooltip-row"},$={class:"tooltip-value"},H={key:0,class:"tooltip-row"},J={class:"tooltip-value"};function q(t,e,s,n,i,v){return c(),a("div",B,[o("button",{class:p(["service-button",n.statusClass]),onClick:e[0]||(e[0]=(...d)=>n.handleClick&&n.handleClick(...d)),onMouseenter:e[1]||(e[1]=d=>n.showTooltip=!0),onMouseleave:e[2]||(e[2]=d=>n.showTooltip=!1),title:n.tooltipText},[o("span",O,u(s.service.name),1),o("span",N,":"+u(s.service.port),1)],42,A),n.showTooltip&&s.showTooltips?(c(),a("div",{key:0,class:p(["service-tooltip",{"tooltip-visible":n.showTooltip}])},[o("div",F,[o("div",U,[o("strong",null,u(s.service.name)+":"+u(s.service.port),1),o("span",{class:p(["tooltip-status",n.statusClass])},u(s.service.status),3)]),o("div",V,[o("div",R,[e[3]||(e[3]=o("span",null,"Type:",-1)),o("span",j,u(n.serviceTypeDisplay),1)]),o("div",P,[e[4]||(e[4]=o("span",null,"Source:",-1)),o("span",$,u(s.service.source||"Unknown"),1)]),s.service.last_check?(c(),a("div",H,[e[5]||(e[5]=o("span",null,"Last Check:",-1)),o("span",J,u(n.formatLastCheck),1)])):m("",!0)])])],2)):m("",!0)])}const Ve=b(W,[["render",q],["__scopeId","data-v-02e4216d"]]),G={name:"VMDetails",props:{vm:{type:Object,required:!0},size:{type:String,default:"compact",validator:t=>["compact","expanded"].includes(t)},showActions:{type:Boolean,default:!1},actionLoading:{type:Boolean,default:!1},vmSystemInfo:{type:Object,default:null},uptimeSeconds:{type:Number,default:0},servers:{type:Array,default:()=>[]}},emits:["wake","suspend","shutdown","stop"],setup(t){const e=L(),s=h(()=>{var r;switch((r=t.vm.status)==null?void 0:r.toLowerCase()){case"running":case"active":case"on":return"status-online";case"stopped":case"off":case"inactive":return"status-offline";case"suspended":case"paused":return"status-suspended";case"stopping":case"suspending":case"waking":return"status-transitioning";default:return"status-unknown"}}),n=h(()=>{if(!t.vmSystemInfo)return null;const r=t.vmSystemInfo.power_meter_watts||t.vmSystemInfo.power_estimate_watts;return r?Math.round(r):null}),i=h(()=>{var l;const r=(l=t.vm.status)==null?void 0:l.toLowerCase();return r==="stopped"||r==="off"||r==="inactive"||r==="suspended"||r==="paused"}),v=h(()=>{var l;const r=(l=t.vm.status)==null?void 0:l.toLowerCase();return r==="running"||r==="active"||r==="on"}),d=h(()=>{var l;const r=(l=t.vm.status)==null?void 0:l.toLowerCase();return r==="running"||r==="active"||r==="on"}),C=h(()=>{var l;const r=(l=t.vm.status)==null?void 0:l.toLowerCase();return r==="running"||r==="active"||r==="on"||r==="suspended"||r==="paused"}),g=h(()=>{if(!t.uptimeSeconds)return null;const r=t.uptimeSeconds,l=Math.floor(r/(24*3600)),f=Math.floor(r%(24*3600)/3600),w=Math.floor(r%3600/60);return l>0?`${l}d ${f}h ${w}m`:f>0?`${f}h ${w}m`:`${w}m`});return{vmStatusClass:s,vmPowerUsage:n,canWake:i,canSuspend:v,canShutdown:d,canStop:C,uptime:g,navigateToDetail:()=>{const r=t.servers.find(l=>{var f;return l.name===t.vm.name||l.hostname===t.vm.name||((f=l.system_info)==null?void 0:f.vm_id)&&l.system_info.vm_id===t.vm.vm_id});r?(console.log(`Navigating to VM server details: ${r.name} (${r.id})`),e.push(`/server/${r.id}`)):console.log(`VM ${t.vm.name} not found as managed server`)}}}},K={class:"vm-header"},Q={class:"vm-info"},X={class:"vm-name"},Y={class:"vm-meta"},Z={key:0,class:"vm-id"},ee={key:1,class:"vm-ip"},se={class:"vm-status-container"},te={key:0,class:"vm-system-details"},ne={class:"vm-metrics"},oe={class:"metric-item"},re={class:"metric-value"},ie={key:0,class:"metric-item"},ae={class:"metric-value"},ce={key:1,class:"metric-item"},le={class:"metric-value"},de={key:2,class:"metric-item"},ue={class:"metric-value"},me={key:0,class:"vm-network"},ve={class:"interface-list"},he={class:"interface-name"},fe={class:"interface-ip"},ge={class:"interface-mac"},we={key:1,class:"vm-uptime"},_e={class:"uptime-value"},ke={key:1,class:"vm-actions"},pe=["disabled"],ye={key:0,class:"loading w-3 h-3 mr-1"},Se={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be=["disabled"],Ce={key:0,class:"loading w-3 h-3 mr-1"},Me={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Te=["disabled"],xe={key:0,class:"loading w-3 h-3 mr-1"},De={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ie=["disabled"],Le={key:0,class:"loading w-3 h-3 mr-1"},Ee={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"};function ze(t,e,s,n,i,v){return c(),a("div",{class:p(["vm-details-card",[s.size==="compact"?"compact":"expanded"]])},[o("div",K,[o("div",Q,[o("h4",X,u(s.vm.name),1),o("div",Y,[s.vm.vm_id?(c(),a("span",Z,"ID: "+u(s.vm.vm_id),1)):m("",!0),s.vm.primary_ip?(c(),a("span",ee,u(s.vm.primary_ip),1)):m("",!0)])]),o("div",se,[o("span",{class:p(["vm-status",n.vmStatusClass])},u(s.vm.status),3)])]),s.size==="expanded"&&s.vmSystemInfo?(c(),a("div",te,[o("div",ne,[o("div",oe,[e[5]||(e[5]=o("span",{class:"metric-label"},"OS:",-1)),o("span",re,u(s.vmSystemInfo.os_version||"Unknown"),1)]),s.vmSystemInfo.cpu_usage?(c(),a("div",ie,[e[6]||(e[6]=o("span",{class:"metric-label"},"CPU:",-1)),o("span",ae,u(s.vmSystemInfo.cpu_usage.toFixed(1))+"%",1)])):m("",!0),s.vmSystemInfo.memory_usage?(c(),a("div",ce,[e[7]||(e[7]=o("span",{class:"metric-label"},"Memory:",-1)),o("span",le,u(s.vmSystemInfo.memory_usage.used_percent.toFixed(1))+"%",1)])):m("",!0),n.vmPowerUsage?(c(),a("div",de,[e[8]||(e[8]=o("span",{class:"metric-label"},"Power:",-1)),o("span",ue,u(n.vmPowerUsage)+"W",1)])):m("",!0)]),s.vmSystemInfo.ip_addresses&&s.vmSystemInfo.ip_addresses.length>0?(c(),a("div",me,[e[9]||(e[9]=o("h5",{class:"section-title"},"Network Interfaces",-1)),o("div",ve,[(c(!0),a(D,null,I(s.vmSystemInfo.ip_addresses,d=>(c(),a("div",{key:d.name,class:"interface-item"},[o("span",he,u(d.name),1),o("span",fe,u(d.ip_address),1),o("span",ge,u(d.mac_address),1)]))),128))])])):m("",!0),n.uptime?(c(),a("div",we,[e[10]||(e[10]=o("span",{class:"uptime-label"},"Uptime:",-1)),o("span",_e,u(n.uptime),1)])):m("",!0)])):m("",!0),s.size==="expanded"&&s.showActions?(c(),a("div",ke,[n.canWake?(c(),a("button",{key:0,onClick:e[0]||(e[0]=d=>t.$emit("wake",s.vm.vm_id)),class:"btn btn-primary btn-sm",disabled:s.actionLoading,title:"Start VM"},[s.actionLoading?(c(),a("span",ye)):(c(),a("svg",Se,e[11]||(e[11]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h1m4 0h1m-6 4h1m4 0h1"},null,-1)]))),e[12]||(e[12]=y(" Start ",-1))],8,pe)):m("",!0),n.canSuspend?(c(),a("button",{key:1,onClick:e[1]||(e[1]=d=>t.$emit("suspend",s.vm.vm_id)),class:"btn btn-warning btn-sm",disabled:s.actionLoading,title:"Suspend VM (preserves RAM state)"},[s.actionLoading?(c(),a("span",Ce)):(c(),a("svg",Me,e[13]||(e[13]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6"},null,-1)]))),e[14]||(e[14]=y(" Suspend ",-1))],8,be)):m("",!0),n.canShutdown?(c(),a("button",{key:2,onClick:e[2]||(e[2]=d=>t.$emit("shutdown",s.vm.vm_id)),class:"btn btn-secondary btn-sm",disabled:s.actionLoading,title:"Graceful shutdown"},[s.actionLoading?(c(),a("span",xe)):(c(),a("svg",De,e[15]||(e[15]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18 12M6 12l12.728 6.364"},null,-1)]))),e[16]||(e[16]=y(" Shutdown ",-1))],8,Te)):m("",!0),n.canStop?(c(),a("button",{key:3,onClick:e[3]||(e[3]=d=>t.$emit("stop",s.vm.vm_id)),class:"btn btn-error btn-sm",disabled:s.actionLoading,title:"Force stop (like pulling power cord)"},[s.actionLoading?(c(),a("span",Le)):(c(),a("svg",Ee,e[17]||(e[17]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 10h6v4H9z"},null,-1)]))),e[18]||(e[18]=y(" Stop ",-1))],8,Ie)):m("",!0),o("button",{onClick:e[4]||(e[4]=(...d)=>n.navigateToDetail&&n.navigateToDetail(...d)),class:"btn btn-ghost btn-sm"}," Details ")])):m("",!0)],2)}const Re=b(G,[["render",ze],["__scopeId","data-v-3b3ef942"]]),We={name:"ThemeToggle",setup(){const t=T(!1),e=i=>{i?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light")),t.value=i},s=()=>{e(!t.value)},n=()=>{const i=localStorage.getItem("theme");if(i)e(i==="dark");else{const v=window.matchMedia("(prefers-color-scheme: dark)").matches;e(v)}};return E(()=>{n()}),{isDark:t,toggleTheme:s}}},Be=["title"],Ae={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},Oe={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"};function Ne(t,e,s,n,i,v){return c(),a("button",{onClick:e[0]||(e[0]=(...d)=>n.toggleTheme&&n.toggleTheme(...d)),class:"theme-toggle-btn",title:n.isDark?"Switch to light mode":"Switch to dark mode"},[n.isDark?(c(),a("svg",Ae,e[1]||(e[1]=[o("path",{"fill-rule":"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z","clip-rule":"evenodd"},null,-1)]))):(c(),a("svg",Oe,e[2]||(e[2]=[o("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"},null,-1)])))],8,Be)}const je=b(We,[["render",Ne],["__scopeId","data-v-be432828"]]);export{Ve as S,je as T,Re as V,Ue as u};
