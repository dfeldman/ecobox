import{_ as N,h as q,f as u,c,a as e,b as y,t as d,n as A,F,i as O,e as T,g as z,j as M,o as a,k as V,l as E,m as P,u as R,p as G,q as H}from"./index-DhluikCv.js";import{V as J,S as K,T as Q,u as X}from"./ThemeToggle-DUAuil17.js";const Y={name:"ServerCard",components:{ServiceButton:K,VMDetails:J},props:{server:{type:Object,required:!0}},emits:["wake","suspend"],setup(l){const s=z(),o=q(!1),t=u(()=>{switch(l.server.current_state){case"on":return"Online";case"off":return"Offline";case"suspended":return"Suspended";case"unknown":return"Unknown";case"init_failed":return"Init Failed";default:return l.server.current_state}}),S=u(()=>{const n="status-indicator";switch(l.server.current_state){case"on":return`${n} status-online`;case"off":return`${n} status-offline`;case"suspended":return`${n} status-suspended`;default:return`${n} status-unknown`}}),C=u(()=>{var r,b;const n=((r=l.server.system_info)==null?void 0:r.power_meter_watts)||((b=l.server.system_info)==null?void 0:b.power_estimate_watts);return n?Math.round(n):null}),k=u(()=>{var r;const n=(r=l.server.system_info)==null?void 0:r.memory_usage;return n?n.used_percent.toFixed(1):0}),g=u(()=>{var r;const n=(r=l.server.system_info)==null?void 0:r.network_usage;return n?((n.mbps_recv||0)+(n.mbps_sent||0)).toFixed(1):"0"}),h=u(()=>{if(l.server.current_state!=="on"||!l.server.last_state_change)return null;const n=new Date(l.server.last_state_change),b=new Date-n,x=Math.floor(b/1e3),f=Math.floor(x/60),v=Math.floor(f/60),w=Math.floor(v/24);return w>0?`${w}d ${v%24}h ${f%60}m`:v>0?`${v}h ${f%60}m`:`${f}m`}),_=n=>n==="up"?"service-online":"service-offline",m=n=>n==="running"?"vm-running":"vm-stopped",L=n=>{console.log(`Clicked service: ${n.name}:${n.port}`),U()},B=n=>null,D=n=>0,U=()=>{s.push(`/server/${l.server.id}`)},W=u(()=>{const n=l.server.current_state;return n==="off"||n==="suspended"||n==="unknown"||n==="init_failed"}),j=u(()=>{var r;const n=l.server.current_state;return(n==="on"||n==="init_failed")&&((r=l.server.system_info)==null?void 0:r.suspend_support)});return{actionLoading:o,statusText:t,statusClass:S,powerUsage:C,memoryUsage:k,networkUsage:g,uptimeDisplay:h,serviceStatusClass:_,vmStatusClass:m,handleServiceClick:L,getVMSystemInfo:B,getVMUptime:D,navigateToDetail:U,showWakeButton:W,showSuspendButton:j}}},Z={class:"card hover:shadow-lg transition-shadow cursor-pointer",style:{"background-color":"var(--bg-primary)",border:"1px solid var(--border-color)"}},$={class:"card-body"},ee={class:"flex items-start justify-between mb-4"},se={class:"font-semibold text-lg",style:{color:"var(--text-primary)"}},te={class:"text-sm",style:{color:"var(--text-secondary)"}},ne={class:"flex flex-col items-end gap-2"},oe={key:0,class:"text-sm",style:{color:"var(--text-secondary)"}},re={key:0,class:"mb-4 space-y-2"},ae={class:"flex justify-between text-sm"},ie={style:{color:"var(--text-primary)"}},ce={class:"flex justify-between text-sm"},le={style:{color:"var(--text-primary)"}},de={class:"flex justify-between text-sm"},ue={style:{color:"var(--text-primary)"}},me={key:1,class:"mb-4"},ve={class:"text-sm mb-2",style:{color:"var(--text-secondary)"}},_e={class:"flex flex-wrap gap-2"},ye={key:0,class:"service-button",style:{"background-color":"var(--bg-secondary)",color:"var(--text-secondary)","border-color":"var(--border-color)"}},fe={key:2,class:"mb-4"},ge={class:"text-sm mb-2",style:{color:"var(--text-secondary)"}},he={class:"space-y-2"},be={key:0,class:"vm-details-card compact",style:{"background-color":"var(--bg-secondary)",color:"var(--text-secondary)","border-color":"var(--border-color)","text-align":"center",padding:"0.5rem"}},ke={key:3,class:"mb-4"},xe={class:"flex justify-between text-sm"},we={style:{color:"var(--text-primary)","font-weight":"500"}},pe={class:"flex gap-2 mt-4"},Se=["disabled"],Ce={key:0,class:"loading w-3 h-3 mr-1"},Me=["disabled"],De={key:0,class:"loading w-3 h-3 mr-1"};function Ue(l,s,o,t,S,C){var h,_;const k=M("ServiceButton"),g=M("VMDetails");return a(),c("div",Z,[e("div",$,[e("div",ee,[e("div",{onClick:s[0]||(s[0]=(...m)=>t.navigateToDetail&&t.navigateToDetail(...m)),class:"flex-1 cursor-pointer"},[e("h3",se,d(o.server.name),1),e("p",te,d(o.server.hostname),1)]),e("div",ne,[e("span",{class:A(t.statusClass)},d(t.statusText),3),t.powerUsage?(a(),c("div",oe,d(t.powerUsage)+"W ",1)):y("",!0)])]),o.server.system_info?(a(),c("div",re,[e("div",ae,[s[4]||(s[4]=e("span",{style:{color:"var(--text-secondary)"}},"CPU:",-1)),e("span",ie,d(((h=o.server.system_info.cpu_usage)==null?void 0:h.toFixed(1))||0)+"%",1)]),e("div",ce,[s[5]||(s[5]=e("span",{style:{color:"var(--text-secondary)"}},"Memory:",-1)),e("span",le,d(t.memoryUsage)+"%",1)]),e("div",de,[s[6]||(s[6]=e("span",{style:{color:"var(--text-secondary)"}},"Network:",-1)),e("span",ue,d(t.networkUsage)+" Mbps",1)])])):y("",!0),o.server.services&&o.server.services.length>0?(a(),c("div",me,[e("div",ve," Services ("+d(o.server.services.length)+"): ",1),e("div",_e,[(a(!0),c(F,null,O(o.server.services.slice(0,4),m=>(a(),V(k,{key:m.id,service:m,onClick:t.handleServiceClick},null,8,["service","onClick"]))),128)),o.server.services.length>4?(a(),c("span",ye," +"+d(o.server.services.length-4)+" more ",1)):y("",!0)])])):y("",!0),(_=o.server.system_info)!=null&&_.vms&&o.server.system_info.vms.length>0?(a(),c("div",fe,[e("div",ge," VMs ("+d(o.server.system_info.vms.length)+"): ",1),e("div",he,[(a(!0),c(F,null,O(o.server.system_info.vms.slice(0,3),m=>(a(),V(g,{key:m.vm_id,vm:m,size:"compact","vm-system-info":t.getVMSystemInfo(m),"uptime-seconds":t.getVMUptime(m)},null,8,["vm","vm-system-info","uptime-seconds"]))),128)),o.server.system_info.vms.length>3?(a(),c("div",be," +"+d(o.server.system_info.vms.length-3)+" more VMs ",1)):y("",!0)])])):y("",!0),t.uptimeDisplay?(a(),c("div",ke,[e("div",xe,[s[7]||(s[7]=e("span",{style:{color:"var(--text-secondary)"}},"Uptime:",-1)),e("span",we,d(t.uptimeDisplay),1)])])):y("",!0),e("div",pe,[t.showWakeButton?(a(),c("button",{key:0,onClick:s[1]||(s[1]=m=>l.$emit("wake",o.server.id)),class:"btn btn-primary btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(a(),c("span",Ce)):y("",!0),s[8]||(s[8]=T(" Wake ",-1))],8,Se)):y("",!0),t.showSuspendButton?(a(),c("button",{key:1,onClick:s[2]||(s[2]=m=>l.$emit("suspend",o.server.id)),class:"btn btn-secondary btn-sm flex-1",disabled:t.actionLoading},[t.actionLoading?(a(),c("span",De)):y("",!0),s[9]||(s[9]=T(" Suspend ",-1))],8,Me)):y("",!0),e("button",{onClick:s[3]||(s[3]=(...m)=>t.navigateToDetail&&t.navigateToDetail(...m)),class:"btn btn-secondary btn-sm"}," Details ")])])])}const Te=N(Y,[["render",Ue]]),Ve={name:"Dashboard",components:{ServerCard:Te,ThemeToggle:Q},setup(){const l=z(),s=R(),o=X(),t=u(()=>o.servers),S=u(()=>o.loading),C=u(()=>o.error),k=u(()=>o.websocketConnected),g=u(()=>s.isAdmin),h=u(()=>{const n=[...t.value],r=i=>i.includes("-vm-")||i.toLowerCase().includes("vm"),b=i=>i.includes("-vm-")?i.split("-vm-")[0]:i.replace(/[-_]?vm[-_]?\d+/i,""),x=n.filter(i=>!r(i.name)),f=n.filter(i=>r(i.name));x.sort((i,p)=>i.name.localeCompare(p.name));const v={};f.forEach(i=>{const p=b(i.name);v[p]||(v[p]=[]),v[p].push(i)}),Object.keys(v).forEach(i=>{v[i].sort((p,I)=>p.name.localeCompare(I.name))});const w=[];return x.forEach(i=>{w.push(i),v[i.name]&&(w.push(...v[i.name]),delete v[i.name])}),Object.values(v).forEach(i=>{w.push(...i)}),w}),_=u(()=>t.value.filter(n=>n.current_state==="on").length),m=u(()=>t.value.filter(n=>n.current_state==="off").length),L=u(()=>t.value.filter(n=>n.current_state==="suspended").length),B=u(()=>t.value.reduce((n,r)=>{var x,f;const b=((x=r.system_info)==null?void 0:x.power_meter_watts)||((f=r.system_info)==null?void 0:f.power_estimate_watts)||0;return n+b},0).toFixed(0)),D=async()=>{await o.fetchServers()},U=async()=>{await s.logout(),l.push("/login")},W=async n=>{const r=await o.wakeServer(n);r.success?console.log(r.message):console.error(r.message)},j=async n=>{const r=await o.suspendServer(n);r.success?console.log(r.message):console.error(r.message)};return G(async()=>{await D(),o.initializeWebSocket()}),H(()=>{o.disconnectWebSocket()}),{servers:t,sortedServers:h,loading:S,error:C,websocketConnected:k,isAdmin:g,onlineCount:_,offlineCount:m,suspendedCount:L,totalPowerUsage:B,fetchServers:D,handleLogout:U,handleWake:W,handleSuspend:j}}},Le={class:"min-h-screen bg-gray-50",style:{"background-color":"var(--bg-secondary)"}},Be={class:"main-header"},We={class:"container mx-auto px-6 py-4"},je={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-4"},Oe={class:"flex items-center gap-3"},Ee={class:"container mx-auto px-6 py-6"},Pe={key:0,class:"text-center py-8"},Ne={key:1,class:"text-center py-8"},Ae={class:"text-red-500"},ze={key:2},Ie={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},qe={class:"card stats-card"},Re={style:{color:"var(--primary-color)"}},Ge={class:"card stats-card"},He={style:{color:"#ef4444"}},Je={class:"card stats-card"},Ke={style:{color:"#f59e0b"}},Qe={class:"card stats-card"},Xe={style:{color:"var(--accent-color)"}},Ye={key:0,class:"text-center py-8"},Ze={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"};function $e(l,s,o,t,S,C){const k=M("ThemeToggle"),g=M("router-link"),h=M("ServerCard");return a(),c("div",Le,[e("header",Be,[e("div",We,[e("div",je,[e("div",Fe,[s[2]||(s[2]=e("h1",{class:"brand-title"},"EcoBox",-1)),s[3]||(s[3]=e("p",{class:"text-sm",style:{color:"var(--text-light)",margin:"0"}},"Sustainable Server Management",-1)),e("div",{class:A(["connection-indicator",t.websocketConnected?"connection-connected":"connection-disconnected"])},d(t.websocketConnected?"Connected":"Disconnected"),3)]),e("nav",Oe,[E(k),t.isAdmin?(a(),V(g,{key:0,to:"/users",class:"btn btn-secondary btn-sm"},{default:P(()=>s[4]||(s[4]=[T(" Users ",-1)])),_:1,__:[4]})):y("",!0),E(g,{to:"/profile",class:"btn btn-secondary btn-sm"},{default:P(()=>s[5]||(s[5]=[T(" Profile ",-1)])),_:1,__:[5]}),e("button",{onClick:s[0]||(s[0]=(..._)=>t.handleLogout&&t.handleLogout(..._)),class:"btn btn-danger btn-sm"}," Logout ")])])])]),e("main",Ee,[t.loading?(a(),c("div",Pe,s[6]||(s[6]=[e("div",{class:"loading w-8 h-8 mx-auto"},null,-1),e("p",{class:"mt-4",style:{color:"var(--text-secondary)"}},"Loading servers...",-1)]))):t.error?(a(),c("div",Ne,[e("p",Ae,d(t.error),1),e("button",{onClick:s[1]||(s[1]=(..._)=>t.fetchServers&&t.fetchServers(..._)),class:"btn btn-primary mt-4"}," Retry ")])):(a(),c("div",ze,[e("div",Ie,[e("div",qe,[e("h3",Re,d(t.onlineCount),1),s[7]||(s[7]=e("p",null,"Online",-1))]),e("div",Ge,[e("h3",He,d(t.offlineCount),1),s[8]||(s[8]=e("p",null,"Offline",-1))]),e("div",Je,[e("h3",Ke,d(t.suspendedCount),1),s[9]||(s[9]=e("p",null,"Suspended",-1))]),e("div",Qe,[e("h3",Xe,d(t.totalPowerUsage)+"W",1),s[10]||(s[10]=e("p",null,"Power Usage",-1))])]),t.servers.length===0?(a(),c("div",Ye,s[11]||(s[11]=[e("p",{style:{color:"var(--text-secondary)"}},"No servers configured",-1)]))):(a(),c("div",Ze,[(a(!0),c(F,null,O(t.sortedServers,_=>(a(),V(h,{key:_.id,server:_,onWake:t.handleWake,onSuspend:t.handleSuspend},null,8,["server","onWake","onSuspend"]))),128))]))]))])])}const ts=N(Ve,[["render",$e]]);export{ts as default};
