import{J as D,K as y,_ as S,h as T,f as h,c as a,a as o,b as u,t as c,n as w,o as i,F as x,i as I,e as M,g as E,p as W}from"./index-DhluikCv.js";class z{constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.isManualClose=!1,this.listeners={open:[],close:[],error:[],message:[]}}connect(){if(this.ws&&this.ws.readyState===WebSocket.OPEN)return;this.isManualClose=!1;const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;try{this.ws=new WebSocket(s),this.ws.onopen=t=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.listeners.open.forEach(r=>r(t))},this.ws.onclose=t=>{console.log("WebSocket disconnected",t.code,t.reason),this.listeners.close.forEach(r=>r(t)),!this.isManualClose&&this.reconnectAttempts<this.maxReconnectAttempts&&t.code!==1e3&&t.code!==1002&&this.scheduleReconnect()},this.ws.onerror=t=>{console.error("WebSocket error:",t),this.listeners.error.forEach(r=>r(t))},this.ws.onmessage=t=>{try{const r=JSON.parse(t.data);this.listeners.message.forEach(v=>v(r))}catch(r){console.error("Error parsing WebSocket message:",r)}}}catch(t){console.error("Error creating WebSocket:",t),this.scheduleReconnect()}}scheduleReconnect(){this.reconnectAttempts++,console.log(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${this.reconnectDelay}ms`),setTimeout(()=>{this.isManualClose||this.connect()},this.reconnectDelay),this.reconnectDelay=Math.min(this.reconnectDelay*2,this.maxReconnectDelay)}disconnect(){this.isManualClose=!0,this.ws&&(this.ws.close(),this.ws=null)}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket is not open, cannot send message")}onOpen(e){this.listeners.open.push(e)}onClose(e){this.listeners.close.push(e)}onError(e){this.listeners.error.push(e)}onMessage(e){this.listeners.message.push(e)}removeListener(e,s){const t=this.listeners[e].indexOf(s);t>-1&&this.listeners[e].splice(t,1)}get isConnected(){return this.ws&&this.ws.readyState===WebSocket.OPEN}}const g=new z,We=D("servers",{state:()=>({servers:[],currentServer:null,loading:!1,error:null,websocketConnected:!1}),getters:{getServerById:n=>e=>n.servers.find(s=>s.id===e),onlineServers:n=>n.servers.filter(e=>e.current_state==="on"),offlineServers:n=>n.servers.filter(e=>e.current_state==="off"),suspendedServers:n=>n.servers.filter(e=>e.current_state==="suspended"),serversByState:n=>n.servers.reduce((e,s)=>(e[s.current_state]||(e[s.current_state]=[]),e[s.current_state].push(s),e),{})},actions:{async fetchServers(){var n,e;this.loading=!0,this.error=null;try{const s=await y.get("/servers");this.servers=s.data.data}catch(s){this.error=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to fetch servers",console.error("Error fetching servers:",s)}finally{this.loading=!1}},async fetchServer(n){var e,s;this.loading=!0,this.error=null;try{const t=await y.get(`/servers/${n}`);this.currentServer=t.data.data;const r=this.servers.findIndex(v=>v.id===n);r!==-1&&(this.servers[r]=t.data.data)}catch(t){this.error=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to fetch server",console.error("Error fetching server:",t)}finally{this.loading=!1}},async wakeServer(n){var e,s;try{return{success:!0,message:(await y.post(`/servers/${n}/wake`)).data.message}}catch(t){const r=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to wake server";return console.error("Error waking server:",t),{success:!1,message:r}}},async suspendServer(n){var e,s;try{return{success:!0,message:(await y.post(`/servers/${n}/suspend`)).data.message}}catch(t){const r=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to suspend server";return console.error("Error suspending server:",t),{success:!1,message:r}}},initializeWebSocket(){g.connect(),g.onOpen(()=>{this.websocketConnected=!0}),g.onClose(()=>{this.websocketConnected=!1}),g.onMessage(n=>{this.handleWebSocketUpdate(n)})},handleWebSocketUpdate(n){if(n.server_id&&n.server){const e=this.servers.findIndex(s=>s.id===n.server_id);e!==-1&&(this.servers[e]={...this.servers[e],...n.server}),this.currentServer&&this.currentServer.id===n.server_id&&(this.currentServer={...this.currentServer,...n.server})}},disconnectWebSocket(){g.disconnect(),this.websocketConnected=!1},clearError(){this.error=null}}}),L={name:"ServiceButton",props:{service:{type:Object,required:!0},showTooltips:{type:Boolean,default:!0}},emits:["click"],setup(n,{emit:e}){const s=T(!1),t=h(()=>n.service.status==="up"?"service-online":"service-offline"),r=h(()=>{const m=n.service.type||"custom";return m.charAt(0).toUpperCase()+m.slice(1)}),v=h(()=>{const m=n.service.status==="up"?"Online":"Offline",f=r.value;return`${n.service.name}:${n.service.port} - ${m} (${f})`}),d=h(()=>{if(!n.service.last_check)return"Never";const m=new Date(n.service.last_check),_=new Date-m,b=Math.floor(_/1e3),p=Math.floor(b/60),k=Math.floor(p/60),C=Math.floor(k/24);return C>0?`${C}d ago`:k>0?`${k}h ago`:p>0?`${p}m ago`:`${b}s ago`});return{showTooltip:s,statusClass:t,serviceTypeDisplay:r,tooltipText:v,formatLastCheck:d,handleClick:()=>{e("click",n.service)}}}},O={class:"service-button-wrapper"},A=["title"],B={class:"service-name"},N={class:"service-port"},U={class:"tooltip-content"},F={class:"tooltip-header"},P={class:"tooltip-details"},R={class:"tooltip-row"},V={class:"tooltip-value"},$={class:"tooltip-row"},j={class:"tooltip-value"},J={key:0,class:"tooltip-row"},q={class:"tooltip-value"};function H(n,e,s,t,r,v){return i(),a("div",O,[o("button",{class:w(["service-button",t.statusClass]),onClick:e[0]||(e[0]=(...d)=>t.handleClick&&t.handleClick(...d)),onMouseenter:e[1]||(e[1]=d=>t.showTooltip=!0),onMouseleave:e[2]||(e[2]=d=>t.showTooltip=!1),title:t.tooltipText},[o("span",B,c(s.service.name),1),o("span",N,":"+c(s.service.port),1)],42,A),t.showTooltip&&s.showTooltips?(i(),a("div",{key:0,class:w(["service-tooltip",{"tooltip-visible":t.showTooltip}])},[o("div",U,[o("div",F,[o("strong",null,c(s.service.name)+":"+c(s.service.port),1),o("span",{class:w(["tooltip-status",t.statusClass])},c(s.service.status),3)]),o("div",P,[o("div",R,[e[3]||(e[3]=o("span",null,"Type:",-1)),o("span",V,c(t.serviceTypeDisplay),1)]),o("div",$,[e[4]||(e[4]=o("span",null,"Source:",-1)),o("span",j,c(s.service.source||"Unknown"),1)]),s.service.last_check?(i(),a("div",J,[e[5]||(e[5]=o("span",null,"Last Check:",-1)),o("span",q,c(t.formatLastCheck),1)])):u("",!0)])])],2)):u("",!0)])}const ze=S(L,[["render",H],["__scopeId","data-v-02e4216d"]]),K={name:"VMDetails",props:{vm:{type:Object,required:!0},size:{type:String,default:"compact",validator:n=>["compact","expanded"].includes(n)},showActions:{type:Boolean,default:!1},actionLoading:{type:Boolean,default:!1},vmSystemInfo:{type:Object,default:null},uptimeSeconds:{type:Number,default:0}},emits:["wake","suspend"],setup(n){E();const e=h(()=>{var l;switch((l=n.vm.status)==null?void 0:l.toLowerCase()){case"running":case"active":case"on":return"status-online";case"stopped":case"off":case"inactive":return"status-offline";case"suspended":case"paused":return"status-suspended";default:return"status-unknown"}}),s=h(()=>{if(!n.vmSystemInfo)return null;const l=n.vmSystemInfo.power_meter_watts||n.vmSystemInfo.power_estimate_watts;return l?Math.round(l):null}),t=h(()=>{var m;const l=(m=n.vm.status)==null?void 0:m.toLowerCase();return l==="stopped"||l==="off"||l==="inactive"}),r=h(()=>{var m;const l=(m=n.vm.status)==null?void 0:m.toLowerCase();return l==="running"||l==="active"||l==="on"}),v=h(()=>{if(!n.uptimeSeconds)return null;const l=n.uptimeSeconds,m=Math.floor(l/(24*3600)),f=Math.floor(l%(24*3600)/3600),_=Math.floor(l%3600/60);return m>0?`${m}d ${f}h ${_}m`:f>0?`${f}h ${_}m`:`${_}m`});return{vmStatusClass:e,vmPowerUsage:s,canWake:t,canSuspend:r,uptime:v,navigateToDetail:()=>{console.log(`Navigate to VM details: ${n.vm.name} (${n.vm.vm_id})`)}}}},G={class:"vm-header"},Q={class:"vm-info"},X={class:"vm-name"},Y={class:"vm-meta"},Z={key:0,class:"vm-id"},ee={key:1,class:"vm-ip"},se={class:"vm-status-container"},te={key:0,class:"vm-system-details"},ne={class:"vm-metrics"},oe={class:"metric-item"},re={class:"metric-value"},ae={key:0,class:"metric-item"},ie={class:"metric-value"},ce={key:1,class:"metric-item"},le={class:"metric-value"},de={key:2,class:"metric-item"},me={class:"metric-value"},ue={key:0,class:"vm-network"},ve={class:"interface-list"},he={class:"interface-name"},fe={class:"interface-ip"},_e={class:"interface-mac"},ge={key:1,class:"vm-uptime"},we={class:"uptime-value"},ye={key:1,class:"vm-actions"},pe=["disabled"],ke={key:0,class:"loading w-3 h-3 mr-1"},Se=["disabled"],be={key:0,class:"loading w-3 h-3 mr-1"};function Ce(n,e,s,t,r,v){return i(),a("div",{class:w(["vm-details-card",[s.size==="compact"?"compact":"expanded"]])},[o("div",G,[o("div",Q,[o("h4",X,c(s.vm.name),1),o("div",Y,[s.vm.vm_id?(i(),a("span",Z,"ID: "+c(s.vm.vm_id),1)):u("",!0),s.vm.primary_ip?(i(),a("span",ee,c(s.vm.primary_ip),1)):u("",!0)])]),o("div",se,[o("span",{class:w(["vm-status",t.vmStatusClass])},c(s.vm.status),3)])]),s.size==="expanded"&&s.vmSystemInfo?(i(),a("div",te,[o("div",ne,[o("div",oe,[e[3]||(e[3]=o("span",{class:"metric-label"},"OS:",-1)),o("span",re,c(s.vmSystemInfo.os_version||"Unknown"),1)]),s.vmSystemInfo.cpu_usage?(i(),a("div",ae,[e[4]||(e[4]=o("span",{class:"metric-label"},"CPU:",-1)),o("span",ie,c(s.vmSystemInfo.cpu_usage.toFixed(1))+"%",1)])):u("",!0),s.vmSystemInfo.memory_usage?(i(),a("div",ce,[e[5]||(e[5]=o("span",{class:"metric-label"},"Memory:",-1)),o("span",le,c(s.vmSystemInfo.memory_usage.used_percent.toFixed(1))+"%",1)])):u("",!0),t.vmPowerUsage?(i(),a("div",de,[e[6]||(e[6]=o("span",{class:"metric-label"},"Power:",-1)),o("span",me,c(t.vmPowerUsage)+"W",1)])):u("",!0)]),s.vmSystemInfo.ip_addresses&&s.vmSystemInfo.ip_addresses.length>0?(i(),a("div",ue,[e[7]||(e[7]=o("h5",{class:"section-title"},"Network Interfaces",-1)),o("div",ve,[(i(!0),a(x,null,I(s.vmSystemInfo.ip_addresses,d=>(i(),a("div",{key:d.name,class:"interface-item"},[o("span",he,c(d.name),1),o("span",fe,c(d.ip_address),1),o("span",_e,c(d.mac_address),1)]))),128))])])):u("",!0),t.uptime?(i(),a("div",ge,[e[8]||(e[8]=o("span",{class:"uptime-label"},"Uptime:",-1)),o("span",we,c(t.uptime),1)])):u("",!0)])):u("",!0),s.size==="expanded"&&s.showActions?(i(),a("div",ye,[t.canWake?(i(),a("button",{key:0,onClick:e[0]||(e[0]=d=>n.$emit("wake",s.vm.vm_id)),class:"btn btn-primary btn-sm",disabled:s.actionLoading},[s.actionLoading?(i(),a("span",ke)):u("",!0),e[9]||(e[9]=M(" Start ",-1))],8,pe)):u("",!0),t.canSuspend?(i(),a("button",{key:1,onClick:e[1]||(e[1]=d=>n.$emit("suspend",s.vm.vm_id)),class:"btn btn-secondary btn-sm",disabled:s.actionLoading},[s.actionLoading?(i(),a("span",be)):u("",!0),e[10]||(e[10]=M(" Stop ",-1))],8,Se)):u("",!0),o("button",{onClick:e[2]||(e[2]=(...d)=>t.navigateToDetail&&t.navigateToDetail(...d)),class:"btn btn-secondary btn-sm"}," Details ")])):u("",!0)],2)}const Le=S(K,[["render",Ce],["__scopeId","data-v-c0262a96"]]),Me={name:"ThemeToggle",setup(){const n=T(!1),e=r=>{r?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light")),n.value=r},s=()=>{e(!n.value)},t=()=>{const r=localStorage.getItem("theme");if(r)e(r==="dark");else{const v=window.matchMedia("(prefers-color-scheme: dark)").matches;e(v)}};return W(()=>{t()}),{isDark:n,toggleTheme:s}}},Te=["title"],De={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},xe={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"};function Ie(n,e,s,t,r,v){return i(),a("button",{onClick:e[0]||(e[0]=(...d)=>t.toggleTheme&&t.toggleTheme(...d)),class:"theme-toggle-btn",title:t.isDark?"Switch to light mode":"Switch to dark mode"},[t.isDark?(i(),a("svg",De,e[1]||(e[1]=[o("path",{"fill-rule":"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z","clip-rule":"evenodd"},null,-1)]))):(i(),a("svg",xe,e[2]||(e[2]=[o("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"},null,-1)])))],8,Te)}const Oe=S(Me,[["render",Ie],["__scopeId","data-v-be432828"]]);export{ze as S,Oe as T,Le as V,We as u};
