import{J as N,K as g,_ as S,c as r,a as e,b as u,l as T,m as j,j as P,t as c,F as V,i as F,w as z,d as p,v as B,L as I,e as v,u as H,h as m,r as K,f as _,p as q,o}from"./index-DhluikCv.js";import{r as J}from"./format-WGrLFNq2.js";const O=N("users",{state:()=>({users:[],loading:!1,error:null}),actions:{async fetchUsers(){var n,s;this.loading=!0,this.error=null;try{const l=await g.get("/auth/users");this.users=l.data.data.users}catch(l){this.error=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"Failed to fetch users",console.error("Error fetching users:",l)}finally{this.loading=!1}},async createUser(n,s=!1){var l,t;this.loading=!0,this.error=null;try{const d=await g.post("/auth/users",{username:n,is_admin:s});return this.users.push(d.data.data.user),{success:!0,message:d.data.message,initialPassword:d.data.data.initial_password}}catch(d){return this.error=((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to create user",{success:!1,message:this.error}}finally{this.loading=!1}},async deleteUser(n){var s,l;this.loading=!0,this.error=null;try{const t=await g.delete(`/auth/users/${n}`);return this.users=this.users.filter(d=>d.username!==n),{success:!0,message:t.data.message}}catch(t){return this.error=((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to delete user",{success:!1,message:this.error}}finally{this.loading=!1}},clearError(){this.error=null}}}),R={name:"Users",setup(){const n=O(),s=H(),l=m(!1),t=m(null),d=m(!1),x=m({}),h=m(!1),a=m(!1),f=m(null),y=m(null),b=K({username:"",isAdmin:!1}),U=_(()=>n.users),k=_(()=>n.loading),C=_(()=>n.error),D=_(()=>s.user),w=async()=>{await n.fetchUsers()},L=i=>{if(!i||i==="0001-01-01T00:00:00Z")return"Never";try{return J(new Date(i),"MMM dd, yyyy HH:mm")}catch{return"Invalid date"}},A=async()=>{h.value=!0,f.value=null;const i=await n.createUser(b.username,b.isAdmin);i.success?(x.value={username:b.username,initialPassword:i.initialPassword},b.username="",b.isAdmin=!1,l.value=!1,d.value=!0):f.value=i.message,h.value=!1},E=i=>{t.value=i,y.value=null},M=async()=>{if(!t.value)return;a.value=!0,y.value=null;const i=await n.deleteUser(t.value.username);i.success?t.value=null:y.value=i.message,a.value=!1};return q(()=>{w()}),{users:U,loading:k,error:C,currentUser:D,showCreateUser:l,userToDelete:t,showSuccess:d,successData:x,createLoading:h,deleteLoading:a,createError:f,deleteError:y,newUser:b,fetchUsers:w,formatDate:L,handleCreateUser:A,confirmDelete:E,handleDeleteUser:M}}},Y={class:"min-h-screen bg-gray-50"},Z={class:"bg-white shadow"},G={class:"container mx-auto px-6 py-4"},Q={class:"flex items-center justify-between"},W={class:"flex items-center gap-4"},X={class:"container mx-auto px-6 py-8"},$={class:"card"},ee={class:"card-header"},se={class:"flex items-center justify-between"},te={class:"card-body"},ae={key:0,class:"text-center py-8"},re={key:1,class:"text-center py-8"},oe={class:"text-red-500"},ne={key:2,class:"text-center py-8"},le={key:3,class:"overflow-x-auto"},ie={class:"w-full"},de={class:"py-3 px-4 font-medium"},ce={class:"py-3 px-4"},ue={key:0,class:"text-green-600"},me={key:1,class:"text-gray-600"},fe={class:"py-3 px-4 text-sm text-gray-600"},be={class:"py-3 px-4 text-sm text-gray-600"},he={class:"py-3 px-4"},ye=["onClick"],_e={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},xe={class:"card w-full max-w-md"},ge={class:"card-body"},ve={class:"form-group"},we=["disabled"],pe={class:"form-group"},Ue={class:"flex items-center gap-2"},ke=["disabled"],Ce={key:0,class:"text-red text-sm mb-4"},De={class:"flex gap-2"},Le=["disabled"],Ae={key:0,class:"loading w-3 h-3 mr-1"},Ee=["disabled"],Me={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ne={class:"card w-full max-w-md"},Se={class:"card-body"},Te={class:"mb-4"},je={key:0,class:"text-red text-sm mb-4"},Pe={class:"flex gap-2"},Ve=["disabled"],Fe={key:0,class:"loading w-3 h-3 mr-1"},ze=["disabled"],Be={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ie={class:"card w-full max-w-md"},He={class:"card-body"},Ke={class:"mb-4"},qe={class:"bg-yellow-50 border border-yellow-200 rounded p-4 mb-4"},Je={class:"font-mono text-sm bg-yellow-100 p-2 rounded mt-2"};function Oe(n,s,l,t,d,x){const h=P("router-link");return o(),r("div",Y,[e("header",Z,[e("div",G,[e("div",Q,[e("div",W,[T(h,{to:"/",class:"btn btn-secondary btn-sm"},{default:j(()=>s[9]||(s[9]=[v(" ← Dashboard ",-1)])),_:1,__:[9]}),s[10]||(s[10]=e("h1",{class:"text-2xl font-bold text-gray-900"},"User Management",-1))])])])]),e("main",X,[e("div",$,[e("div",ee,[e("div",se,[s[11]||(s[11]=e("h3",{class:"font-semibold"},"Users",-1)),e("button",{onClick:s[0]||(s[0]=a=>t.showCreateUser=!0),class:"btn btn-primary"}," Create User ")])]),e("div",te,[t.loading?(o(),r("div",ae,s[12]||(s[12]=[e("div",{class:"loading w-8 h-8 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading users...",-1)]))):t.error?(o(),r("div",re,[e("p",oe,c(t.error),1),e("button",{onClick:s[1]||(s[1]=(...a)=>t.fetchUsers&&t.fetchUsers(...a)),class:"btn btn-primary mt-4"}," Retry ")])):t.users.length===0?(o(),r("div",ne,s[13]||(s[13]=[e("p",{class:"text-gray-600"},"No users found",-1)]))):(o(),r("div",le,[e("table",ie,[s[14]||(s[14]=e("thead",null,[e("tr",{class:"border-b"},[e("th",{class:"text-left py-3 px-4"},"Username"),e("th",{class:"text-left py-3 px-4"},"Admin"),e("th",{class:"text-left py-3 px-4"},"Created"),e("th",{class:"text-left py-3 px-4"},"Last Login"),e("th",{class:"text-left py-3 px-4"},"Actions")])],-1)),e("tbody",null,[(o(!0),r(V,null,F(t.users,a=>{var f;return o(),r("tr",{key:a.username,class:"border-b"},[e("td",de,c(a.username),1),e("td",ce,[a.is_admin?(o(),r("span",ue,"Yes")):(o(),r("span",me,"No"))]),e("td",fe,c(t.formatDate(a.created_at)),1),e("td",be,c(t.formatDate(a.last_login)),1),e("td",he,[a.username!==((f=t.currentUser)==null?void 0:f.username)?(o(),r("button",{key:0,onClick:y=>t.confirmDelete(a),class:"btn btn-danger btn-sm"}," Delete ",8,ye)):u("",!0)])])}),128))])])]))])])]),t.showCreateUser?(o(),r("div",_e,[e("div",xe,[s[18]||(s[18]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold"},"Create New User")],-1)),e("div",ge,[e("form",{onSubmit:s[5]||(s[5]=z((...a)=>t.handleCreateUser&&t.handleCreateUser(...a),["prevent"]))},[e("div",ve,[s[15]||(s[15]=e("label",{class:"form-label"},"Username",-1)),p(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.newUser.username=a),type:"text",required:"",class:"form-input",disabled:t.createLoading},null,8,we),[[B,t.newUser.username]])]),e("div",pe,[e("label",Ue,[p(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>t.newUser.isAdmin=a),type:"checkbox",disabled:t.createLoading},null,8,ke),[[I,t.newUser.isAdmin]]),s[16]||(s[16]=e("span",{class:"text-sm"},"Administrator",-1))])]),t.createError?(o(),r("div",Ce,c(t.createError),1)):u("",!0),e("div",De,[e("button",{type:"submit",class:"btn btn-primary flex-1",disabled:t.createLoading},[t.createLoading?(o(),r("span",Ae)):u("",!0),s[17]||(s[17]=v(" Create ",-1))],8,Le),e("button",{type:"button",onClick:s[4]||(s[4]=a=>t.showCreateUser=!1),class:"btn btn-secondary flex-1",disabled:t.createLoading}," Cancel ",8,Ee)])],32)])])])):u("",!0),t.userToDelete?(o(),r("div",Me,[e("div",Ne,[s[20]||(s[20]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold"},"Confirm Delete")],-1)),e("div",Se,[e("p",Te,'Are you sure you want to delete user "'+c(t.userToDelete.username)+'"? This action cannot be undone.',1),t.deleteError?(o(),r("div",je,c(t.deleteError),1)):u("",!0),e("div",Pe,[e("button",{onClick:s[6]||(s[6]=(...a)=>t.handleDeleteUser&&t.handleDeleteUser(...a)),class:"btn btn-danger flex-1",disabled:t.deleteLoading},[t.deleteLoading?(o(),r("span",Fe)):u("",!0),s[19]||(s[19]=v(" Delete ",-1))],8,Ve),e("button",{onClick:s[7]||(s[7]=a=>t.userToDelete=null),class:"btn btn-secondary flex-1",disabled:t.deleteLoading}," Cancel ",8,ze)])])])])):u("",!0),t.showSuccess?(o(),r("div",Be,[e("div",Ie,[s[23]||(s[23]=e("div",{class:"card-header"},[e("h3",{class:"font-semibold"},"User Created")],-1)),e("div",He,[e("p",Ke,'User "'+c(t.successData.username)+'" has been created successfully.',1),e("div",qe,[s[21]||(s[21]=e("p",{class:"text-sm font-medium text-yellow-800"},"Initial Password:",-1)),e("p",Je,c(t.successData.initialPassword),1),s[22]||(s[22]=e("p",{class:"text-xs text-yellow-700 mt-2"},"Please save this password. It will not be shown again.",-1))]),e("button",{onClick:s[8]||(s[8]=a=>t.showSuccess=!1),class:"btn btn-primary w-full"}," OK ")])])])):u("",!0)])}const Ze=S(R,[["render",Oe]]);export{Ze as default};
